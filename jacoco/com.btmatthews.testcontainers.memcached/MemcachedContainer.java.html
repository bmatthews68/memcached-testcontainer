<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MemcachedContainer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Testcontainer for Memcached</a> &gt; <a href="index.source.html" class="el_package">com.btmatthews.testcontainers.memcached</a> &gt; <span class="el_source">MemcachedContainer.java</span></div><h1>MemcachedContainer.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2021 Brian Matthews
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.btmatthews.testcontainers.memcached;

import net.spy.memcached.MemcachedClient;
import net.spy.memcached.MemcachedClientIF;
import org.testcontainers.containers.GenericContainer;
import org.testcontainers.containers.wait.strategy.HostPortWaitStrategy;
import org.testcontainers.utility.DockerImageName;

import java.io.IOException;
import java.net.InetSocketAddress;

/**
 * Testcontainer module for Memcached.
 *
 * @author Brian Matthews
 */
public class MemcachedContainer extends GenericContainer&lt;MemcachedContainer&gt; {

    /**
     * The default container image name.
     */
<span class="fc" id="L37">    private static final DockerImageName DEFAULT_IMAGE_NAME = DockerImageName.parse(&quot;memcached&quot;);</span>

    /**
     * The default version tag.
     */
    private static final String DEFAULT_TAG = &quot;1.6.9&quot;;

    /**
     * The Memcached interface port.
     */
    private static final int MEMCACHED_PORT = 11211;

    /**
     * Create a container image with default image name and version.
     */
    @Deprecated
    public MemcachedContainer() {
<span class="nc" id="L54">        this(DEFAULT_IMAGE_NAME.withTag(DEFAULT_TAG));</span>
<span class="nc" id="L55">    }</span>

    /**
     * Create the container using the image name string.
     *
     * @param dockerImageName The image name string.
     */
    public MemcachedContainer(final String dockerImageName) {
<span class="nc" id="L63">        this(DockerImageName.parse(dockerImageName));</span>
<span class="nc" id="L64">    }</span>

    /**
     * Create the container using the parsed image name.
     *
     * @param dockerImageName The parsed image name.
     */
    public MemcachedContainer(final DockerImageName dockerImageName) {
<span class="fc" id="L72">        super(dockerImageName);</span>

<span class="fc" id="L74">        dockerImageName.assertCompatibleWith(DEFAULT_IMAGE_NAME);</span>

<span class="fc" id="L76">        addExposedPorts(MEMCACHED_PORT);</span>
<span class="fc" id="L77">        setWaitStrategy(new HostPortWaitStrategy());</span>
<span class="fc" id="L78">    }</span>

    /**
     * Get the mapped port for Memcached.
     *
     * @return The mapped port.
     */
    public int getMemcachedPort() {
<span class="fc" id="L86">        return getMappedPort(MEMCACHED_PORT);</span>
    }

    /**
     * Get a client that can be used to store and retrieve items in Memcached.
     *
     * @return The client.
     * @throws IOException If there was an error initialising the client.
     */
    public MemcachedClientIF getClient() throws IOException {
<span class="fc" id="L96">        final InetSocketAddress address = new InetSocketAddress(getHost(), getMemcachedPort());</span>
<span class="fc" id="L97">        return new MemcachedClient(address);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>